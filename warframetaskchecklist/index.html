<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warframe Checklist</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    body {
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg2) 100%);
        color: var(--color-text);
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: var(--color-panel);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid var(--color-accent);
        padding: 30px;
        box-shadow: 0 20px 40px rgba(75, 56, 50, 0.15);
    }

    .header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--color-accent);
    }

    .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--color-accent2), var(--color-accent), var(--color-bg2));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }

    .header p {
        color: var(--color-accent2);
        font-size: 1.1rem;
    }

    .section {
        margin-bottom: 35px;
        background: var(--color-panel);
        border-radius: 15px;
        padding: 25px;
        border: 1px solid var(--color-accent);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .section:hover {
        box-shadow: 0 10px 25px rgba(75, 56, 50, 0.08);
    }

    .section-title {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--color-accent2);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-title::before {
        content: '';
        width: 4px;
        height: 25px;
        background: linear-gradient(135deg, var(--color-accent2), var(--color-accent));
        border-radius: 2px;
    }

    .task-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
    }

    .task-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 15px;
        background: var(--color-panel);
        border-radius: 10px;
        border: 1px solid var(--color-accent);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .task-main {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .task-item:hover {
        background: color-mix(in srgb, var(--color-accent) 13%, transparent);
        border-color: var(--color-accent);
    }

    .task-item.completed {
        opacity: 0.6;
        background: color-mix(in srgb, var(--color-accent) 20%, transparent);
    }

    .task-item.completed .task-text {
        text-decoration: line-through;
    }

    .checkbox {
        width: 18px;
        height: 18px;
        border: 2px solid var(--color-accent2);
        border-radius: 4px;
        cursor: pointer;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
        background: var(--color-panel);
    }

    .checkbox.checked {
        background: linear-gradient(135deg, var(--color-accent2), var(--color-accent));
        border-color: var(--color-accent);
    }

    .checkbox.checked::after {
        content: '✓';
        position: absolute;
        top: -2px;
        left: 2px;
        color: var(--color-panel);
        font-size: 12px;
        font-weight: bold;
    }

    .task-text {
        flex: 1;
        min-width: 0;
        overflow-wrap: break-word;
        font-size: 0.95rem;
        color: var(--color-text);
    }

    .task-timer {
        font-size: 0.85rem;
        color: var(--color-accent2);
        background: color-mix(in srgb, var(--color-accent) 13%, transparent);
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid var(--color-accent);
        text-align: center;
        font-weight: 500;
        letter-spacing: 0.5px;
    }

    .delete-btn {
        background: var(--color-accent2);
        border: none;
        color: var(--color-panel);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        cursor: pointer;
        opacity: 0;
        transition: all 0.3s ease;
        position: absolute;
        top: 8px;
        right: 8px;
    }

    .task-item:hover .delete-btn {
        opacity: 1;
    }

    .delete-btn:hover {
        background: var(--color-bg2);
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        background: color-mix(in srgb, var(--color-accent) 20%, transparent);
        border-radius: 3px;
        margin: 20px 0;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--color-accent2), var(--color-accent));
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    .stats {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .stat-item {
        text-align: center;
        padding: 15px;
        background: color-mix(in srgb, var(--color-accent) 13%, transparent);
        border-radius: 10px;
        min-width: 120px;
        border: 1px solid var(--color-accent);
    }

    .stat-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--color-accent);
    }

    .stat-label {
        font-size: 0.9rem;
        color: var(--color-text);
        margin-top: 5px;
    }

    .add-task-btn {
        background: linear-gradient(135deg, var(--color-accent2), var(--color-accent));
        border: none;
        color: var(--color-panel);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 150px;
        text-align: center;
    }

    .add-task-btn:hover {
        box-shadow: 0 5px 15px color-mix(in srgb, var(--color-accent) 33%, transparent);
        background: linear-gradient(135deg, var(--color-accent), var(--color-accent2));
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: color-mix(in srgb, var(--color-bg2) 80%, transparent);
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background: var(--color-panel);
        margin: 10% auto;
        padding: 30px;
        border: 1px solid var(--color-accent);
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 20px 40px rgba(75, 56, 50, 0.15);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--color-accent);
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--color-accent2);
    }

    .close {
        color: var(--color-accent2);
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .close:hover {
        color: var(--color-bg2);
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: var(--color-accent);
        font-weight: 500;
    }

    .form-input {
        width: 100%;
        padding: 12px;
        background: var(--color-panel);
        border: 1px solid var(--color-accent);
        border-radius: 8px;
        color: var(--color-text);
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--color-accent2);
        box-shadow: 0 0 10px color-mix(in srgb, var(--color-accent) 33%, transparent);
    }

    .form-select {
        width: 100%;
        padding: 12px;
        background: var(--color-panel);
        border: 1px solid var(--color-accent);
        border-radius: 8px;
        color: var(--color-text);
        font-size: 1rem;
        cursor: pointer;
    }

    .modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-top: 25px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--color-accent2), var(--color-accent));
        border: none;
        color: var(--color-panel);
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        box-shadow: 0 5px 15px color-mix(in srgb, var(--color-accent) 33%, transparent);
        background: linear-gradient(135deg, var(--color-accent), var(--color-accent2));
    }

    .btn-secondary {
        background: var(--color-panel) !important;
        color: var(--color-accent2) !important;
        border: 1.5px solid var(--color-accent2) !important;
        border-radius: 8px !important;
        padding: 12px 24px !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer;
        box-shadow: none !important;
        text-shadow: none !important;
        transition: background 0.3s, color 0.3s;
    }

    .btn-secondary:hover {
        background: color-mix(in srgb, var(--color-accent2) 13%, transparent) !important;
        color: var(--color-accent) !important;
        border-color: var(--color-accent) !important;
    }

    .reset-menu-container {
        position: relative;
    }

    .reset-menu {
        display: none;
        position: absolute;
        right: 0;
        background: var(--color-panel);
        border: 1px solid var(--color-accent);
        border-radius: 8px;
        margin-top: 5px;
        min-width: 200px;
        z-index: 1000;
        box-shadow: 0 8px 20px rgba(75,56,50,0.15);
    }

    .reset-menu button {
        background: transparent;
        color: var(--color-accent2);
        font-size: 0.9rem;
        font-weight: 600;
        text-align: left;
        border: none;
        cursor: pointer;
        padding: 10px 15px;
        width: 100%;
        transition: background 0.2s ease;
    }

    .reset-menu button:hover {
        background: color-mix(in srgb, var(--color-accent) 20%, transparent);
    }

    .reset-menu button:last-child {
        color: #FF0000;
    }

    .task-item.dragging {
        opacity: 0.4;
        transform: scale(1.02);
        box-shadow: 0 0 15px color-mix(in srgb, var(--color-accent) 33%, transparent);
    }

    .task-item.drag-over {
        border: 2px dashed var(--color-accent2);
        background: color-mix(in srgb, var(--color-accent) 13%, transparent);
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
            margin: 10px;
        }
        
        .header h1 {
            font-size: 2rem;
        }
        
        .task-list {
            grid-template-columns: 1fr;
        }
        
        .stats {
            gap: 15px;
        }
    }

    .palette-picker {
        margin-top: 20px;
        text-align: center;
    }

    .palette-picker label {
        font-weight: 500;
        color: var(--color-bg2);
        margin-right: 10px;
    }

    .palette-picker select {
        padding: 10px;
        border: 1px solid var(--color-accent);
        border-radius: 8px;
        background: var(--color-panel);
        color: var(--color-text);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .palette-picker select:hover {
        border-color: var(--color-accent2);
    }

    .palette-picker input[type="color"] {
        -webkit-appearance: none;
        appearance: none;
        width: 36px;
        height: 36px;
        border: none;
        cursor: pointer;
        padding: 0;
        margin: 0 4px;
        border-radius: 4px;
        transition: transform 0.3s ease;
    }

    .palette-picker input[type="color"]:hover {
        transform: scale(1.1);
    }

    .palette-picker input[type="checkbox"] {
        transform: scale(1.2);
        margin-right: 6px;
        cursor: pointer;
    }

    /* Add to your <style> section or CSS file */

.palette-picker-toggle {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-left: 14px;
    font-size: 1rem;
    cursor: pointer;
    user-select: none;
    position: relative;
}

.palette-switch,
.palette-drag {
    width: 38px;
    height: 22px;
    background: var(--color-bg2);
    border-radius: 12px;
    position: relative;
    transition: background 0.3s;
    border: 1.5px solid var(--color-accent2);
    display: inline-block;
    vertical-align: middle;
}

.palette-switch input,
.palette-drag input {
    opacity: 0;
    width: 0;
    height: 0;
}

.palette-slider,
.palette-drag-slider {
    position: absolute;
    top: 50%;
    left: 2px;
    width: 18px;
    height: 18px;
    background: var(--color-accent2);
    border-radius: 50%;
    transition: transform 0.3s, background 0.3s;
    box-shadow: 0 1px 4px #0002;
    transform: translateY(-50%);
}

.palette-switch input:checked + .palette-slider {
    transform: translate(16px, -50%);
    background: var(--color-accent);
}

.palette-drag input:checked + .palette-drag-slider {
    transform: translate(16px, -50%);
    background: var(--color-accent);
}

.palette-switch input:checked ~ .palette-switch-icon {
    color: var(--color-accent);
}

.palette-drag input:checked ~ .palette-drag-icon {
    color: var(--color-accent);
}

/* Remove gradients from buttons and set solid backgrounds */
.add-task-btn,
.btn-primary {
    background: var(--color-accent2) !important;
    color: var(--color-panel) !important;
    border: none !important;
    box-shadow: none !important;
    text-shadow: none !important;
    font-weight: 600;
    transition: background 0.3s;
}

.add-task-btn:hover,
.btn-primary:hover {
    background: var(--color-accent) !important;
}

/* Change text color of toggle buttons */
.palette-picker-toggle[title="Toggle dark mode"] span:last-child,
.palette-picker-toggle[title="Enable drag & drop"] span:last-child {
    color: var(--color-accent2) !important;
    font-weight: 600;
}

.timer-bell .bell-icon {
    transition: color 0.2s;
}
.timer-bell:active .bell-icon,
.timer-bell[title*="scheduled"] .bell-icon {
    color: var(--color-accent);
}

.timer-bell.active .bell-icon {
    color: gold !important;
    text-shadow:
        0 0 6px var(--color-bell-glow),   /* bell glow color */
        0 0 2px var(--color-bell-glow2);  /* bell glow secondary */
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Warframe Task Checklist</h1>
            <p>Stay organized with your daily Tenno duties</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="progressPercent">0%</div>
                <div class="stat-label">Progress</div>
            </div>
            <div class="stat-item">
                <div class="reset-menu-container">
                    <button id="resetMenuBtn" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9rem;">
                        ⚙️ Reset Options ▼
                    </button>
                    <div id="resetMenu" class="reset-menu">
                        <button onclick="TaskManager.uncheckAll()">Uncheck All Tasks</button>
                        <button onclick="TaskManager.restoreDefaults()">Restore Deleted Defaults</button>
                        <button onclick="TaskManager.resetPage()">Reset Entire Page</button>
                    </div>
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: center; align-items: center; margin-top: 15px; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
            <button class="add-task-btn" onclick="TaskModal.show()">📝 Add Task</button>
        </div>

        <div class="section" id="dailySection">
            <div class="section-title">Daily Tasks</div>
            <div class="task-list" id="dailyTasks"></div>
        </div>

        <div class="section" id="weeklySection">
            <div class="section-title">Weekly Tasks</div>
            <div class="task-list" id="weeklyTasks"></div>
        </div>

        <div class="section" id="otherSection">
            <div class="section-title">Other Tasks</div>
            <div class="task-list" id="otherTasks"></div>
        </div>

        <!-- Add/replace in your <body> where the palette picker select is defined -->
        <div class="palette-picker">
            <label for="paletteSelect" title="Choose color palette">🎨</label>
            <select id="paletteSelect">
                <option value="narmer">Narmer</option>
                <option value="tenno">Tenno</option>
                <option value="orokin">Orokin</option>
                <option value="grineer">Grineer</option>
                <option value="corpus">Corpus</option>
                <option value="custom">Custom…</option>
            </select>
            <div id="customPaletteInputs" style="display:none; gap:4px;">
                <input type="color" id="custom-bg" title="Background" />
                <input type="color" id="custom-bg2" title="Background 2" />
                <input type="color" id="custom-panel" title="Panel" />
                <input type="color" id="custom-accent" title="Accent" />
                <input type="color" id="custom-accent2" title="Accent 2" />
                <input type="color" id="custom-text" title="Text" />
            </div>
            <span class="palette-picker-toggle" title="Toggle dark mode">
                <label style="cursor:pointer;">
                    <span class="palette-switch">
                        <input type="checkbox" id="paletteDarkToggle" />
                        <span class="palette-slider"></span>
                    </span>
                    <span style="margin-left:8px;">Dark Mode</span>
                </label>
            </span>
            <span class="palette-picker-toggle" title="Enable drag & drop">
                <label style="cursor:pointer;">
                    <span class="palette-drag">
                        <input type="checkbox" id="dragDropToggle" />
                        <span class="palette-drag-slider"></span>
                    </span>
                    <span style="margin-left:8px;">Drag & Drop</span>
                </label>
            </span>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Custom Task</h2>
                <span class="close" onclick="TaskModal.hide()">&times;</span>
            </div>
            <form onsubmit="TaskModal.addTask(event)">
                <div class="form-group">
                    <label class="form-label" for="taskText">Task Description</label>
                    <input type="text" id="taskText" class="form-input" placeholder="You can use <Resets-mon-00:00-utc>" required />
                </div>
                <div class="form-group">
                    <label class="form-label" for="taskCategory">Category</label>
                    <select id="taskCategory" class="form-select">
                        <option value="daily">Daily Tasks</option>
                        <option value="weekly">Weekly Tasks</option>
                        <option value="other">Other Tasks</option>
                    </select>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="TaskModal.hide()">Cancel</button>
                    <button type="submit" class="btn-primary">Add Task</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Default tasks configuration
        const DEFAULT_TASKS = {
            daily: [
                "Log in: Collect the daily login reward.",
                "Craft Forma, Fieldron, Detonite Injector, Mutagen Mass",
                "Syndicate gains",
                "Sortie: Complete the 3 daily Sortie missions (requires The War Within).",
                "Focus: Max out daily Focus gain (e.g., via Sanctuary Onslaught) (requires The Second Dream).",
                "Steel Path Incursions: Complete daily Steel Path missions for Steel Essence (requires Steel Path unlocked)."
            ],
            weekly: [
                "Nightwave: Complete relevant weekly missions",
                "Check weekly Nightwave offerings",
                "Ayatan Treasure Hunt: Complete Maroo's weekly mission for an Ayatan Sculpture (Maroo's Bazaar)",
                "Help Clem: Help Clem with his weekly survival, or he will die. (Relay)",
                "Weekly Break Narmer Mission: Complete Kahl's weekly mission for Stock (requires Veilbreaker)",
                "Iron Wake (Paladino): Trade Riven Slivers with Paladino (requires The Chains of Harrow)",
                "Archimedian Yonta (Zariman): Buy weekly Kuva with Voidplumes (requires Angels of the Zariman)",
                "Acridies (Duviri/Dormizone): Check wares and spend Pathos Clamps if desired (Catalysts/Reactors recommended if needed)",
                "Archon Hunt: Complete the weekly Archon Hunt for a guaranteed Archon Shard (requires The New War)",
                "Duviri Circuit (Normal): Check weekly Warframe options & run Circuit if desired (requires Duviri)",
                "Duviri Circuit (Steel Path): Check weekly Incarnon Adapters & run Circuit if desired (requires Steel Path & Duviri)",
                "Teshin (Steel Path): Check Teshin's Steel Essence shop (especially for Umbra Forma rotation - approx. every 8 weeks)",
                "Bird 3 (Cavia Syndicate): Buy the weekly Archon Shard for 30k Cavia Standing (requires Rank 5 Cavia)",
                "Netracells (Tagfer): Complete up to 5 weekly Netracell missions for Archon Shard chances (requires Whispers in the Walls)",
                "Elite Deep Archimedea (Necraloid): Attempt weekly Elite Deep Archimedea for high Archon Shard chances (very endgame, requires Whispers in the Walls & Rank 5 Cavia)",
                "Elite Temporal Archimedea (Kaya): Attempt weekly Elite Temporal Archimedea for high Archon Shard chances (very endgame, requires Warframe 1999 & Rank 5 Hex)",
                "Calendar (POM-2 Terminal): Complete weekly Calendar tasks (requires Warframe 1999)",
                "Baro Ki'Teer: Check Baro Ki'Teer's inventory on a Relay and purchase desired items with Ducats (trade Prime parts for Ducats)"
            ],
            other: [
                "Mend the Family: Purchase Family Tokens from Grandmother in the Necralisk (requires Heart of Deimos) <every-04:00-utc>",
                "Trade for Voidplumes: Purchase Voidplumes from Archimedean Yonta in the Chrysalith (requires Angels of the Zariman) <every-04:00-utc>",
                "Trade for Voca: Purchase Voca from Loid in the Sanctum Anatomica (requires Whispers in the Walls) <every-04:00-utc>",
                "Invasions for resources and weapon parts"
            ]
        };

        // Timer utility for parsing and calculating reset times
        class TimerUtils {
            static parseTimerFromText(text) {
                // Weekly or daily: <mon-12:00-utc> or <12:00-utc>
                const weeklyOrDaily = /<(?:(mon|tue|wed|thu|fri|sat|sun)-)?(\d{1,2}):(\d{2})-utc>/i;
                // Interval: <every-04:00-utc>
                const interval = /<every-(\d{1,2}):(\d{2})-utc>/i;

                let match = text.match(weeklyOrDaily);
                if (match) {
                    return {
                        type: match[1] ? 'weekly' : 'daily',
                        weekday: match[1]?.toLowerCase(),
                        hour: parseInt(match[2], 10),
                        minute: parseInt(match[3], 10),
                        label: match[0]
                    };
                }
                match = text.match(interval);
                if (match) {
                    return {
                        type: 'interval',
                        hours: parseInt(match[1], 10),
                        minutes: parseInt(match[2], 10),
                        label: match[0]
                    };
                }
                return null;
            }

            static removeTimerFromText(text) {
                return text.replace(/<[^<>]+-?\d{1,2}:\d{2}-utc>/i, '').trim();
            }

            static calculateTimeRemaining(timerConfig) {
                const now = new Date();
                if (timerConfig.type === 'interval') {
                    // Interval timer
                    const totalMs = (timerConfig.hours * 60 + timerConfig.minutes) * 60 * 1000;
                    const msSinceEpoch = now.getUTCHours() * 3600000 + now.getUTCMinutes() * 60000 + now.getUTCSeconds() * 1000 + now.getUTCMilliseconds();
                    const msSinceLast = msSinceEpoch % totalMs;
                    const msUntilNext = totalMs - msSinceLast;
                    const totalSeconds = Math.floor(msUntilNext / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                } else {
                    // Daily or weekly
                    let nextResetUTC = new Date(Date.UTC(
                        now.getUTCFullYear(),
                        now.getUTCMonth(),
                        now.getUTCDate(),
                        timerConfig.hour,
                        timerConfig.minute,
                        0
                    ));
                    if (timerConfig.type === 'weekly') {
                        const weekdayMap = {sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};
                        const targetDay = weekdayMap[timerConfig.weekday];
                        let daysAhead = (targetDay - nextResetUTC.getUTCDay() + 7) % 7;
                        if (daysAhead === 0 && nextResetUTC <= now) daysAhead = 7;
                        nextResetUTC.setUTCDate(nextResetUTC.getUTCDate() + daysAhead);
                    } else {
                        if (nextResetUTC <= now) nextResetUTC.setUTCDate(nextResetUTC.getUTCDate() + 1);
                    }
                    const totalSeconds = Math.floor((nextResetUTC - now) / 1000);
                    const days = Math.floor(totalSeconds / 86400);
                    const hours = Math.floor((totalSeconds % 86400) / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    let parts = [];
                    if (days > 0) parts.push(`${days}d`);
                    parts.push(
                        String(hours).padStart(2, '0'),
                        String(minutes).padStart(2, '0'),
                        String(seconds).padStart(2, '0')
                    );
                    return `${parts.join(':')}`;
                }
            }
        }

        // Task element creation and management
        class TaskElement {
            static create(rawText) {
                const timerConfig = TimerUtils.parseTimerFromText(rawText);
                const cleanText = TimerUtils.removeTimerFromText(rawText);
                
                const taskItem = document.createElement("div");
                taskItem.dataset.originalText = rawText;
                taskItem.className = "task-item";
                taskItem.draggable = true;
                
                // Store timer configuration as data attributes
                if (timerConfig) {
                    taskItem.dataset.timerLabel = timerConfig.label;
                    if (timerConfig.type === 'interval') {
                        taskItem.dataset.timerHour = timerConfig.hours;
                        taskItem.dataset.timerMinute = timerConfig.minutes;
                        taskItem.dataset.timerType = 'interval';
                    } else {
                        taskItem.dataset.timerHour = timerConfig.hour;
                        taskItem.dataset.timerMinute = timerConfig.minute;
                        taskItem.dataset.timerType = timerConfig.type;
                        if (timerConfig.weekday) {
                            taskItem.dataset.timerWeekday = timerConfig.weekday;
                        }
                    }
                }       
                
                taskItem.innerHTML = `
                    <div class="task-main">
                        <div class="checkbox"></div>
                        <div class="task-text">${cleanText}</div>
                    </div>
                    ${timerConfig ? `
                        <div class="task-timer-container" style="display:flex;align-items:center;gap:6px;">
                            <div class="task-timer"></div>
                            <button class="timer-bell" title="Notify when timer resets" style="background:none;border:none;cursor:pointer;font-size:1.2em;line-height:1;padding:0 2px;">
                                <span class="bell-icon" style="color:var(--color-accent2);">🔔</span>
                            </button>
                        </div>
                    ` : ''}
                    <button class="delete-btn" onclick="TaskManager.deleteTask(event, this)">×</button>
                `;
                
                // Add event listeners
                taskItem.onclick = (e) => {
                    if (!e.target.classList.contains('delete-btn')) {
                        TaskManager.toggleTask(taskItem);
                    }
                };
                
                // Drag and drop handlers
                taskItem.addEventListener("dragstart", DragDrop.handleDragStart);
                taskItem.addEventListener("dragover", DragDrop.handleDragOver);
                taskItem.addEventListener("drop", DragDrop.handleDrop);
                taskItem.addEventListener("dragend", DragDrop.handleDragEnd);
                
                // Timer bell button logic
                if (timerConfig) {
                    const bellBtn = taskItem.querySelector('.timer-bell');
                    let bellActive = false;
                    let bellTimeout = null;

                    bellBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        if (bellActive) {
                            bellActive = false;
                            bellBtn.querySelector('.bell-icon').textContent = '🔔';
                            bellBtn.title = "Notify when timer resets";
                            bellBtn.classList.remove('active');
                            if (bellTimeout) clearTimeout(bellTimeout);
                            return;
                        }
                        bellActive = true;
                        bellBtn.querySelector('.bell-icon').textContent = '🔔';
                        bellBtn.title = "Notification scheduled! Click to cancel.";
                        bellBtn.classList.add('active');

                        // Calculate ms until reset
                        const now = new Date();
                        let nextReset;
                        
                        if (timerConfig.type === 'interval') {
                            // For interval timers, calculate next occurrence
                            const totalMs = (timerConfig.hours * 60 + timerConfig.minutes) * 60 * 1000;
                            const msSinceEpoch = now.getUTCHours() * 3600000 + now.getUTCMinutes() * 60000 + now.getUTCSeconds() * 1000 + now.getUTCMilliseconds();
                            const msSinceLast = msSinceEpoch % totalMs;
                            const msUntilNext = totalMs - msSinceLast;
                            nextReset = new Date(now.getTime() + msUntilNext);
                        } else {
                            // For daily/weekly timers
                            nextReset = new Date(Date.UTC(
                                now.getUTCFullYear(),
                                now.getUTCMonth(),
                                now.getUTCDate(),
                                timerConfig.hour,
                                timerConfig.minute,
                                0
                            ));
                            
                            if (timerConfig.weekday) {
                                const weekdayMap = {sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};
                                const targetDay = weekdayMap[timerConfig.weekday];
                                let daysAhead = (targetDay - nextReset.getUTCDay() + 7) % 7;
                                if (daysAhead === 0 && nextReset <= now) daysAhead = 7;
                                nextReset.setUTCDate(nextReset.getUTCDate() + daysAhead);
                            } else {
                                if (nextReset <= now) nextReset.setUTCDate(nextReset.getUTCDate() + 1);
                            }
                        }
                        
                        const msUntil = nextReset - now;

                        // Schedule the bell notification
                        bellTimeout = setTimeout(() => {
                            // Play sound with error handling for autoplay restrictions
                            const audio = new Audio("notify.mp3");
                            audio.volume = 0.5;
                            audio.play().catch(err => {
                                // If blocked, show a fallback alert
                                alert("🔔 Timer reset! (Enable sound in your browser for audio notification.)");
                            });

                            // Send notification if already granted
                            if (typeof Notification !== "undefined" && Notification.permission === "granted") {
                                new Notification("Warframe Checklist", {
                                    body: `Timer "${timerConfig.label}" has reset!`,
                                    icon: "favicon.ico"
                                });
                            } else {
                                alert(`Timer "${timerConfig.label}" has reset!`);
                            }
                            bellActive = false;
                            bellBtn.querySelector('.bell-icon').textContent = '🔔';
                            bellBtn.title = "Notify when timer resets";
                            bellBtn.classList.remove('active');
                        }, msUntil);
                    });
                }
                
                return taskItem;
            }
            
            static updateTimer(taskItem) {
                const timerDiv = taskItem.querySelector('.task-timer');
                if (!timerDiv) return;

                const timerType = taskItem.dataset.timerType;
                let timerConfig;
                if (timerType === 'interval') {
                    timerConfig = {
                        type: 'interval',
                        hours: parseInt(taskItem.dataset.timerHour, 10),
                        minutes: parseInt(taskItem.dataset.timerMinute, 10),
                        label: taskItem.dataset.timerLabel
                    };
                } else {
                    timerConfig = {
                        type: timerType,
                        hour: parseInt(taskItem.dataset.timerHour, 10),
                        minute: parseInt(taskItem.dataset.timerMinute, 10),
                        weekday: taskItem.dataset.timerWeekday,
                        label: taskItem.dataset.timerLabel
                    };
                }

                timerDiv.textContent = TimerUtils.calculateTimeRemaining(timerConfig);
            }
        }

        // Drag and drop functionality
        class DragDrop {
            static draggedTask = null;

            static handleDragStart(e) {
                DragDrop.draggedTask = this;
                this.classList.add("dragging");
                e.dataTransfer.effectAllowed = "move";
                e.dataTransfer.setData("text/plain", "");
            }

            static handleDragOver(e) {
                e.preventDefault();
                const isAfter = e.offsetY > this.offsetHeight / 2;
                const parent = this.parentElement;
                const sibling = isAfter ? this.nextSibling : this;

                if (DragDrop.draggedTask && DragDrop.draggedTask !== this) {
                    parent.insertBefore(DragDrop.draggedTask, sibling);
                }

                document.querySelectorAll(".task-item").forEach(el => el.classList.remove("drag-over"));
                this.classList.add("drag-over");
            }

            static handleDrop(e) {
                e.stopPropagation();
                this.classList.remove("drag-over");
                ProgressTracker.update();
                TaskStorage.save();
            }

            static handleDragEnd(e) {
                this.classList.remove("dragging");
                document.querySelectorAll(".task-item").forEach(el => el.classList.remove("drag-over"));
            }
        }

        // Progress tracking functionality
        class ProgressTracker {
            static update() {
                const allTasks = document.querySelectorAll(".task-item");
                const completedTasks = document.querySelectorAll(".task-item.completed");
                const completed = completedTasks.length;
                const total = allTasks.length;
                const percent = total ? Math.round((completed / total) * 100) : 0;
                
                document.getElementById("completedTasks").textContent = completed;
                document.getElementById("totalTasks").textContent = total;
                document.getElementById("progressPercent").textContent = `${percent}%`;
                document.getElementById("progressFill").style.width = `${percent}%`;
            }
        }

        // Task storage and URL hash management
        class TaskStorage {
            // ...inside TaskStorage...
            static save() {
                const sections = ["daily", "weekly", "other"];
                const data = [];
                sections.forEach(section => {
                    const container = document.getElementById(`${section}Tasks`);
                    if (!container) return;
                    Array.from(container.querySelectorAll(".task-item")).forEach(taskItem => {
                        // Save the original text, including timer markup if present
                        let originalText = taskItem.dataset.originalText;
                        if (!originalText) {
                            // Fallback for legacy: reconstruct from data attributes if possible
                            const label = taskItem.dataset.timerLabel;
                            const hour = taskItem.dataset.timerHour;
                            const minute = taskItem.dataset.timerMinute;
                            const weekday = taskItem.dataset.timerWeekday;
                            const validWeekdays = ["sun","mon","tue","wed","thu","fri","sat"];
                            if (label && hour !== undefined && minute !== undefined) {
                                const weekdayPart = (weekday && validWeekdays.includes(weekday)) ? `${weekday}-` : '';
                                const hourPart = String(hour).padStart(2, '0');
                                const minutePart = String(minute).padStart(2, '0');
                                originalText = `${taskItem.querySelector(".task-text").textContent} <${label}-${weekdayPart}${hourPart}:${minutePart}-utc>`;
                            } else {
                                originalText = taskItem.querySelector(".task-text").textContent;
                            }
                        }
                        const isCompleted = taskItem.classList.contains("completed");
                        const category = section;
                        data.push({
                            text: originalText,
                            completed: isCompleted,
                            category
                        });
                    });
                });
                localStorage.setItem('warframeChecklistTasks', JSON.stringify(data));
            }

            static load() {
                const saved = localStorage.getItem('warframeChecklistTasks');
                if (!saved) return false;
                try {
                    const savedTasks = JSON.parse(saved);
                    ["daily", "weekly", "other"].forEach(category => {
                        const container = document.getElementById(`${category}Tasks`);
                        if (container) container.innerHTML = "";
                    });
                    savedTasks.forEach(({ text, completed, category }) => {
                        const container = document.getElementById(`${category}Tasks`);
                        if (!container) return;
                        const taskElement = TaskElement.create(text);
                        // Store the original text for future saves
                        taskElement.dataset.originalText = text;
                        if (completed) {
                            taskElement.classList.add("completed");
                            taskElement.querySelector(".checkbox").classList.add("checked");
                        }
                        container.appendChild(taskElement);
                    });
                    return true;
                } catch (error) {
                    console.error("Failed to load tasks from storage:", error);
                    return false;
                }
            }
        }

        // Main task management functionality
        class TaskManager {
            static initialize() {
                // Try to load from URL hash first
                const loadedFromHash = TaskStorage.load();
                
                // If no saved tasks, load defaults
                if (!loadedFromHash) {
                    this.loadDefaultTasks();
                }
                
                // Update progress and start timer updates
                ProgressTracker.update();
                this.startTimerUpdates();
                
                // Setup reset menu
                this.setupResetMenu();
            }

            static loadDefaultTasks() {
                Object.entries(DEFAULT_TASKS).forEach(([category, tasks]) => {
                    const container = document.getElementById(`${category}Tasks`);
                    if (!container) return;
                    
                    tasks.forEach(taskText => {
                        const taskElement = TaskElement.create(taskText);
                        container.appendChild(taskElement);
                    });
                });
            }

            static toggleTask(taskElement) {
                const checkbox = taskElement.querySelector(".checkbox");
                taskElement.classList.toggle("completed");
                checkbox.classList.toggle("checked");
                ProgressTracker.update();
                TaskStorage.save();
            }

            static deleteTask(event, deleteBtn) {
                event.stopPropagation();
                if (confirm("Delete this task?")) {
                    const taskItem = deleteBtn.closest(".task-item");
                    taskItem.remove();
                    ProgressTracker.update();
                    TaskStorage.save();
                }
            }

            static addCustomTask(text, category) {
                const container = document.getElementById(`${category}Tasks`);
                if (!container) return;
                
                const taskElement = TaskElement.create(text);
                container.appendChild(taskElement);
                ProgressTracker.update();
                TaskStorage.save();
            }

            static updateAllTimers() {
                document.querySelectorAll(".task-item").forEach(taskItem => {
                    TaskElement.updateTimer(taskItem);
                });
            }

            static startTimerUpdates() {
                this.updateAllTimers();
                setInterval(() => this.updateAllTimers(), 1000);
            }

            static setupResetMenu() {
                const resetMenuBtn = document.getElementById("resetMenuBtn");
                const resetMenu = document.getElementById("resetMenu");

                resetMenuBtn.addEventListener("click", () => {
                    resetMenu.style.display = resetMenu.style.display === "block" ? "none" : "block";
                });

                // Close menu when clicking outside
                window.addEventListener("click", (e) => {
                    if (!resetMenuBtn.contains(e.target) && !resetMenu.contains(e.target)) {
                        resetMenu.style.display = "none";
                    }
                });
            }

            static uncheckAll() {
                if (!confirm("Uncheck all tasks?")) return;
                
                document.querySelectorAll(".task-item").forEach(taskItem => {
                    taskItem.classList.remove("completed");
                    taskItem.querySelector(".checkbox").classList.remove("checked");
                });
                
                ProgressTracker.update();
                TaskStorage.save();
                document.getElementById("resetMenu").style.display = "none";
            }

            static restoreDefaults() {
                if (!confirm("Restore all deleted default tasks? This will not affect custom tasks.")) return;

                Object.entries(DEFAULT_TASKS).forEach(([category, defaultTasks]) => {
                    const container = document.getElementById(`${category}Tasks`);
                    if (!container) return;

                    // Get current task texts
                    const currentTexts = Array.from(container.querySelectorAll(".task-text"))
                        .map(el => el.textContent.trim());

                    // Add missing default tasks
                    defaultTasks.forEach(taskText => {
                        const cleanText = TimerUtils.removeTimerFromText(taskText);
                        if (!currentTexts.includes(cleanText)) {
                            const taskElement = TaskElement.create(taskText);
                            container.appendChild(taskElement);
                        }
                    });
                });

                ProgressTracker.update();
                TaskStorage.save();
                document.getElementById("resetMenu").style.display = "none";
            }

            static resetPage() {
                if (!confirm("Completely reset the page? This will remove all custom tasks and progress.")) return;

                // Clear all containers
                ["daily", "weekly", "other"].forEach(category => {
                    const container = document.getElementById(`${category}Tasks`);
                    if (container) container.innerHTML = "";
                });

                // Reload default tasks
                this.loadDefaultTasks();
                
                ProgressTracker.update();
                TaskStorage.save();
                document.getElementById("resetMenu").style.display = "none";
            }
        }

        // Modal management for adding tasks
        class TaskModal {
            static show() {
                document.getElementById("addTaskModal").style.display = "block";
            }

            static hide() {
                document.getElementById("addTaskModal").style.display = "none";
                document.getElementById("taskText").value = "";
                document.getElementById("taskCategory").value = "daily";
            }

            static addTask(event) {
                event.preventDefault();
                
                const text = document.getElementById("taskText").value.trim();
                const category = document.getElementById("taskCategory").value;
                
                if (!text) return;
                
                TaskManager.addCustomTask(text, category);
                this.hide();
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener("DOMContentLoaded", () => {
            TaskManager.initialize();
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById("addTaskModal");
            if (event.target === modal) {
                TaskModal.hide();
            }
        };


        // Palette definitions
        const PALETTES = {
            narmer: {
                light: {
                    '--color-bg': '#3c2f2f',
                    '--color-bg2': '#4b3832',
                    '--color-panel': '#fff4e6',
                    '--color-panel-dark': '#3c2f2f',
                    '--color-accent': '#be9b7b',
                    '--color-accent2': '#854442',
                    '--color-text': '#3c2f2f',
                    '--color-text-light': '#fff4e6',
                    '--color-text-accent': '#854442',
                    '--color-bell-glow': '#000',        
                    '--color-bell-glow2': '#fff'       
                },
                dark: {
                    '--color-bg': '#1a1412',
                    '--color-bg2': '#3c2f2f',
                    '--color-panel': '#2a211e',
                    '--color-panel-dark': '#1a1412',
                    '--color-accent': '#be9b7b',
                    '--color-accent2': '#be9b7b',
                    '--color-text': '#fff4e6',
                    '--color-text-light': '#fff4e6',
                    '--color-text-accent': '#be9b7b',
                    '--color-bell-glow': '#ff0',        
                    '--color-bell-glow2': '#fff'       
                }
            },
            tenno: {
                light: {
                    '--color-bg': '#e3eaf2',
                    '--color-bg2': '#b8c6db',
                    '--color-panel': '#f7fafc',
                    '--color-panel-dark': '#e3eaf2',
                    '--color-accent': '#5e81ac',
                    '--color-accent2': '#5e81ac',
                    '--color-text': '#2e3440',
                    '--color-text-light': '#f7fafc',
                    '--color-text-accent': '#5e81ac',
                    '--color-bell-glow': '#000',
                    '--color-bell-glow2': '#fff'
                },
                dark: {
                    '--color-bg': '#2e3440',
                    '--color-bg2': '#434c5e',
                    '--color-panel': '#3b4252',
                    '--color-panel-dark': '#2e3440',
                    '--color-accent': '#81a1c1',
                    '--color-accent2': '#81a1c1',
                    '--color-text': '#eceff4',
                    '--color-text-light': '#eceff4',
                    '--color-text-accent': '#81a1c1',
                    '--color-bell-glow': '#ff0',
                    '--color-bell-glow2': '#fff'
                }
            },
            orokin: {
                light: {
                    '--color-bg': '#f8f6e3',
                    '--color-bg2': '#e9e4c9',
                    '--color-panel': '#fffbe6',
                    '--color-panel-dark': '#f8f6e3',
                    '--color-accent': '#e7c873',
                    '--color-accent2': '#bfa14a',
                    '--color-text': '#6b5e36',
                    '--color-text-light': '#fffbe6',
                    '--color-text-accent': '#bfa14a',
                    '--color-bell-glow': '#000',
                    '--color-bell-glow2': '#fff'
                },
                dark: {
                    '--color-bg': '#2d261b',
                    '--color-bg2': '#6b5e36',
                    '--color-panel': '#3a3322',
                    '--color-panel-dark': '#2d261b',
                    '--color-accent': '#e7c873',
                    '--color-accent2': '#bfa14a',
                    '--color-text': '#fffbe6',
                    '--color-text-light': '#fffbe6',
                    '--color-text-accent': '#e7c873',
                    '--color-bell-glow': '#ff0',
                    '--color-bell-glow2': '#fff'
                }
            },
            grineer: {
                light: {
                    '--color-bg': '#f3e9d2',
                    '--color-bg2': '#bfa46a',
                    '--color-panel': '#fff8e1',
                    '--color-panel-dark': '#f3e9d2',
                    '--color-accent': '#b03a1c',
                    '--color-accent2': '#5c3a1b',
                    '--color-text': '#3d2c1e',
                    '--color-text-light': '#fff8e1',
                    '--color-text-accent': '#b03a1c',
                    '--color-bell-glow': '#000',
                    '--color-bell-glow2': '#fff'
                },
                dark: {
                    '--color-bg': '#2a1d12',
                    '--color-bg2': '#5c3a1b',
                    '--color-panel': '#3d2c1e',
                    '--color-panel-dark': '#2a1d12',
                    '--color-accent': '#b03a1c',
                    '--color-accent2': '#bfa46a',
                    '--color-text': '#fffbe6',           // changed to light yellow
                    '--color-text-light': '#fffbe6',
                    '--color-text-accent': '#ffe082'     // light gold accent for contrast
                }
            },
            corpus: {
                light: {
                    '--color-bg': '#eaf6fb',
                    '--color-bg2': '#b3cde0',
                    '--color-panel': '#f7fafc',
                    '--color-panel-dark': '#eaf6fb',
                    '--color-accent': '#00b4d8',
                    '--color-accent2': '#0077b6',
                    '--color-text': '#1b263b',
                    '--color-text-light': '#f7fafc',
                    '--color-text-accent': '#00b4d8',
                    '--color-bell-glow': '#000',
                    '--color-bell-glow2': '#fff'
                },
                dark: {
                    '--color-bg': '#1b263b',
                    '--color-bg2': '#0077b6',
                    '--color-panel': '#24344d',
                    '--color-panel-dark': '#1b263b',
                    '--color-accent': '#00b4d8',
                    '--color-accent2': '#90e0ef',
                    '--color-text': '#f1f6fb',           // changed to very light blue
                    '--color-text-light': '#f1f6fb',
                    '--color-text-accent': '#90e0ef'     // light blue accent for contrast
                }
            }
        };

        // Utility to apply a palette
        function applyPalette(paletteName, dark) {
            if (paletteName === 'custom') {
                // Custom palette handled below
                return;
            }
            const palette = PALETTES[paletteName] ? (dark ? PALETTES[paletteName].dark : PALETTES[paletteName].light) : PALETTES['narmer'].light;
            for (const key in palette) {
                document.documentElement.style.setProperty(key, palette[key]);
            }
        }

        // Palette picker logic
        const paletteSelect = document.getElementById('paletteSelect');
        const paletteDarkToggle = document.getElementById('paletteDarkToggle');
        const customPaletteInputs = document.getElementById('customPaletteInputs');
        const customKeys = [
            '--color-bg', '--color-bg2', '--color-panel',
            '--color-accent', '--color-accent2', '--color-text'
        ];
        const customInputs = [
            document.getElementById('custom-bg'),
            document.getElementById('custom-bg2'),
            document.getElementById('custom-panel'),
            document.getElementById('custom-accent'),
            document.getElementById('custom-accent2'),
            document.getElementById('custom-text')
        ];

        // Show/hide custom palette inputs and apply palette
        function updatePaletteUI() {
            const selectedPalette = paletteSelect.value;
            const isCustom = selectedPalette === 'custom';
            paletteDarkToggle.disabled = isCustom;
            if (!isCustom) {
                applyPalette(selectedPalette, paletteDarkToggle.checked);
                localStorage.setItem('warframeChecklistPalette', selectedPalette);
                localStorage.setItem('warframeChecklistPaletteDark', paletteDarkToggle.checked ? '1' : '0');
            } else {
                // If no custom palette saved, set some random/fun defaults
                let custom = JSON.parse(localStorage.getItem('warframeChecklistCustomPalette') || '{}');
                if (Object.keys(custom).length === 0) {
                    custom = {
                        '--color-bg': '#222244',
                        '--color-bg2': '#443377',
                        '--color-panel': '#ffeedd',
                        '--color-accent': '#ff6f61',
                        '--color-accent2': '#6bffb8',
                        '--color-text': '#222244'
                    };
                    localStorage.setItem('warframeChecklistCustomPalette', JSON.stringify(custom));
                }
                customInputs.forEach((inp, idx) => {
                    inp.value = custom[customKeys[idx]] || '#ffffff';
                    if (custom[customKeys[idx]]) document.documentElement.style.setProperty(customKeys[idx], custom[customKeys[idx]]);
                });
                localStorage.setItem('warframeChecklistPalette', 'custom');
            }
        }

        // Palette select event
        paletteSelect.addEventListener('change', updatePaletteUI);

        // Dark mode toggle event
        paletteDarkToggle.addEventListener('change', updatePaletteUI);

        // Custom palette color pickers
        customInputs.forEach((input, i) => {
            input.addEventListener('input', () => {
                const custom = {};
                customInputs.forEach((inp, idx) => {
                    custom[customKeys[idx]] = inp.value;
                    document.documentElement.style.setProperty(customKeys[idx], inp.value);
                });
                localStorage.setItem('warframeChecklistCustomPalette', JSON.stringify(custom));
                paletteSelect.value = 'custom';
                customPaletteInputs.style.display = 'flex';
                paletteDarkToggle.disabled = true;
                localStorage.setItem('warframeChecklistPalette', 'custom');
            });
        });

        // On load, apply saved palette or default
        (function() {
            let savedPalette = localStorage.getItem('warframeChecklistPalette');
            let savedDark = localStorage.getItem('warframeChecklistPaletteDark');

            // If no preference saved, default to dark mode
            if (savedPalette === null) savedPalette = 'narmer';
            if (savedDark === null) savedDark = '1'; // '1' means dark mode ON

            paletteSelect.value = savedPalette;
            paletteDarkToggle.checked = savedDark === '1';
            updatePaletteUI();
        })();

        // Drag & Drop toggle logic
        const dragDropToggle = document.getElementById('dragDropToggle');

        // Enable/disable drag and drop on all task items
        function setDragDropEnabled(enabled) {
            document.querySelectorAll('.task-item').forEach(item => {
                item.draggable = enabled;
                if (!enabled) item.classList.remove('dragging', 'drag-over');
            });
            localStorage.setItem('warframeChecklistDragDrop', enabled ? '1' : '0');
        }

        // Listen for toggle changes
        dragDropToggle.addEventListener('change', () => {
            setDragDropEnabled(dragDropToggle.checked);
        });

        // Ensure new tasks respect the toggle
        const origTaskElementCreate = TaskElement.create;
        TaskElement.create = function(...args) {
            const el = origTaskElementCreate.apply(this, args);
            el.draggable = dragDropToggle.checked;
            return el;
        };

        // On load, restore drag & drop state (off by default)
        (function() {
            let savedDragDrop = localStorage.getItem('warframeChecklistDragDrop');
            dragDropToggle.checked = savedDragDrop === '1';
            setDragDropEnabled(dragDropToggle.checked);
        })();
    </script>
</body>
</html>
